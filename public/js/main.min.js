function initDate(e){let t=new Date().toISOString("YYYY-MM-DD");e.value=t.substring(0,t.indexOf("T"))}async function fetchData(){let e=JSON.stringify({method:"load"}),t=await fetch("/load",{body:e,method:"POST"}),n=await t.text();console.log("Data recieved from server.");let l=JSON.parse(n);if(l.nocontent){console.log("User not logged in");return}greetUser(),showElement(document.getElementById("todoForm")),createTable(l)}window.onload=function(){let e=document.querySelector("#submit");e.onclick=submit;let t=document.querySelector("#clear");t.onclick=clearData;let n=document.querySelector("#signout");n.onclick=logout;let l=document.getElementById("duedate");initDate(l),fetchData()};const submit=async function(e){e.preventDefault();let t={};document.getElementById("todoForm").querySelectorAll("[data-send]").forEach(e=>{if(""===e.value){alert("You must fill out all fields!");return}if(void 0===e.id){console.error("ID undefined in form element");return}t[e.id]=e.value}),t.method="submit";let n=JSON.stringify(t),l=await fetch("/submit",{body:n,method:"POST"});"Update"===document.getElementById("submit").textContent&&(document.getElementById("submit").textContent="Submit",document.getElementById("cancelButton").remove()),resetTaskName();let a=await l.text();console.log("Data recieved from server."),createTable(JSON.parse(a))},clearData=async function(e){e.preventDefault();let t=JSON.stringify({method:"clear"}),n=await fetch("/clear",{body:t,method:"POST"}),l=await n.text();console.log(l),document.querySelector("#todo > table").childNodes.forEach(e=>e.remove()),createTableHeaders()},logout=function(e){e.preventDefault(),document.cookie.split(";").forEach(e=>{document.cookie=e+"; expires=01 Jan 2000 12:00:00 UTC"}),farewellUser()};function createTableHeaders(){let e=document.querySelector("#todo > table");document.getElementById("tableheaders")&&document.getElementById("tableheaders").remove();let t=function(e,t){let n=document.createElement("th");n.appendChild(document.createTextNode(t)),e.appendChild(n)},n=e.insertRow();n.id="tableheaders",n.class="tableheaders",t(n,"Task"),t(n,"Priority"),t(n,"Due Date"),t(n,"Recommended Order")}function createTable(e){let t=document.querySelector("#todo > table");t.childNodes.forEach(e=>e.remove()),createTableHeaders();for(let n=0;n<e.length;n++){let l=t.insertRow(),a=l.insertCell(),o=l.insertCell(),i=l.insertCell(),r=l.insertCell();a.appendChild(document.createTextNode(e[n].taskname)),o.appendChild(document.createTextNode(e[n].priority)),i.appendChild(document.createTextNode(e[n].duedate)),r.appendChild(document.createTextNode(e[n].ordernum));let d=createEditButton(e[n]);a.appendChild(d),l.onmouseover=function(){showElement(d)},l.onmouseout=function(){hideElement(d)},l.onclick=async function(){let t={taskname:e[n].taskname,method:"delete"},a=JSON.stringify(t),o=await fetch("/delete",{body:a,method:"POST"}),i=await o.text();console.log(i),l.remove()}}}function createEditButton(e){let t=document.createElement("button");return t.textContent="Edit",t.id=e.taskname.replaceAll(" ","_")+"EditButton",t.classList="mini ui button right floated",t.title="Edit this task",hideElement(t),t.style.textDecoration="none",t.onclick=function(t){t.preventDefault(),t.stopPropagation();let n=document.getElementById("taskname");n.value=e.taskname,n.disabled=!0,n.classList=n.classList+"disabled",n.ariaDisabled="true",document.getElementById("priority").value=e.priority,document.getElementById("duedate").value=e.duedate,document.getElementById("submit").textContent="Update",createCancelButton()},t}function createCancelButton(){if(null!==document.getElementById("cancelButton"))return;let e=document.createElement("button");e.textContent="Cancel",e.id="cancelButton",e.classList="ui button",e.title="Cancel the current edit",e.onclick=function(t){t.preventDefault(),resetTaskName(),document.getElementById("priority").value="",initDate(document.getElementById("duedate")),document.getElementById("submit").textContent="Submit",e.remove()};let t=document.getElementById("todoForm"),n=t.querySelector("div:first-of-type");n.appendChild(e)}function resetTaskName(){let e=document.getElementById("taskname");e.disabled=!1,e.ariaDisabled="false",e.classList.remove("disabled"),e.value=""}function greetUser(){let e=decodeURIComponent(document.cookie).split("; ").map(e=>e.substring(e.indexOf("=")+1)),t=e[2],n=e[1],l=`${t} (${n})`,a=document.getElementById("welcomeMessage");a.innerText=a.innerText.replace("{User}",l),hideElement(document.getElementById("notLoggedIn")),showElement(document.getElementById("loggedIn"))}function farewellUser(){let e=document.getElementById("welcomeMessage");hideElement(document.getElementById("loggedIn")),e.innerText="Hello, {User}.",showElement(document.getElementById("notLoggedIn")),hideElement(document.getElementById("todoForm")),hideElement(document.getElementById("todo"))}function hideElement(e){e.style.display="none",e.ariaHidden="true"}function showElement(e){e.style.display="inherit",e.ariaHidden="false"}